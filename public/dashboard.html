<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VirtuLease | Dashboard</title>
</head>
<link rel="stylesheet" href="css/style.css">
<body>

<nav>
    <h1>VirtuLease</h1>
    <a href="dashboard.html" id="nav-dash">Dashboard</a>
    <a href="houses.html" id="nav-houses">Houses / Rooms</a>
    <a href="tenants.html" id="nav-tenants">Tenants</a>
        <a href="reports.html">Reports</a>
        <a href="payments.html" id="nav-payments">Payments</a> 
        <a href="notifications.html">Notifications</a>
        <a href="profile.html">Profile</a>


        <button class="logout" onclick="logout()">Logout</button>

</nav>

    <main>
        <div class="header">
            <h2>Landlord Dashboard</h2>
            <p id="current-date"></p>
        </div>

        <div class="stats-grid">
            <div class="card">
                <h3>Total Houses</h3>
                <p id="stat-houses">0</p>
            </div>
            <div class="card">
                <h3>Total Rooms</h3>
                <p id="stat-rooms">0</p>
            </div>
            <div class="card">
                <h3>Occupied</h3>
                <p id="stat-occupied" style="color: var(--success)">0</p>
            </div>
            <!-- <h3>Rent Expiring Soon (30 Days)</h3>
    <table style="margin-top: 15px;">
        <thead>
            <tr>
                <th>Tenant</th>
                <th>Room</th>
                <th>Expiry Date</th>
            </tr>
        </thead>
        <tbody id="expiryList">
            </tbody>
    </table> -->
            <div class="card">
                <h3>Vacant</h3>
                <p id="stat-vacant" style="color: var(--danger)">0</p>
            </div>
            <div class="card">
    <h3>Revenue (Current Month)</h3>
    <p id="stat-revenue" style="color: var(--accent)">₦0</p>
</div>
        </div>
    </main>

    <script>
        document.getElementById('current-date').innerText = new Date().toDateString();

        async function loadStats() {
            try {
                const response = await fetch('/api/dashboard/stats');
                
                if (response.status === 401) {
                    window.location.href = 'login.html';
                    return;
                }

                const data = await response.json();
                
                // Update UI
                document.getElementById('stat-houses').innerText = data.totalHouses || 0;
                document.getElementById('stat-rooms').innerText = data.totalRooms || 0;
                document.getElementById('stat-occupied').innerText = data.occupiedRooms || 0;
                document.getElementById('stat-vacant').innerText = data.vacantRooms || 0;
                document.getElementById('stat-revenue').innerText = `₦${parseFloat(data.monthlyRevenue).toLocaleString()}`;

            } catch (err) {
                console.error("Load Error:", err);
            }
            const expiryList = document.getElementById('expiryList');
if (data.expiringLeases.length === 0) {
    expiryList.innerHTML = '<tr><td colspan="3" style="text-align:center;">No upcoming expirations</td></tr>';
} else {
    expiryList.innerHTML = data.expiringLeases.map(l => `
        <tr>
            <td>${l.full_name}</td>
            <td>${l.room_number}</td>
            <td style="color: var(--danger); font-weight: bold;">
                ${new Date(l.end_date).toLocaleDateString()}
            </td>
        </tr>
    `).join('');
}
        }

        function logout() {
            document.cookie = "token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            window.location.href = 'login.html';
        }

        // Run on load
        loadStats();
    </script>
</body>
</html>